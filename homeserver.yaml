server_name: "matrix.ninbura.com"
pid_file: /data/homeserver.pid

listeners:
  - port: 8008
    tls: false
    type: http
    x_forwarded: true
    resources:
      - names: [client, federation]
        compress: false

database:
 name: psycopg2
 args:
   user: ${DB_USERNAME}
   password: ${DB_PASSWORD}
   database: ${DB_DATABASE_NAME}
   host: synapse-db
   cp_min: 5
   cp_max: 10

log_config: "/data/matrix.ninbura.com.log.config"
media_store_path: /data/media_store
url_preview_enabled: true
registration_shared_secret: ${REGISTRATION_SHARED_SECRET}
report_stats: false
macaroon_secret_key: ${MACAROON_SECRET_KEY} 
form_secret: ${FORM_SECRET}
signing_key_path: "/data/matrix.ninbura.com.signing.key"
trusted_key_servers:
  - server_name: "matrix.org"

enable_registration: true
require_verification_for_email_registration: true
enable_registration_captcha: true
recaptcha_public_key: ${RECAPTCHA_PUBLIC_KEY}
recaptcha_private_key: ${RECAPTCHA_PRIVATE_KEY}

retention:
  enabled: true
  default_policy:
    min_lifetime: 7d
    max_lifetime: 7d

encryption_enabled_by_default_for_room_type: all
block_non_admin_invites: false

modules:
  - module: synapse_user_restrictions.UserRestrictionsModule
    config:
      rules:
        - match: "@ninbura:matrix.ninbura.com"
          allow: [invite, create_room]
        - match: "@jiggyboo:matrix.ninbura.com"
          allow: [invite, create_room]
        - match: "@gloogo:matrix.ninbura.com"
          allow: [invite, create_room]
        - match: "@pezneck:matrix.ninbura.com"
          allow: [invite, create_room]
      default_deny: [invite, create_room]

email:
  smtp_host: ${SMTP_SERVER}
  smtp_port: ${SMTP_PORT}
  smtp_user: ${SMTP_USERNAME}
  smtp_pass: ${SMTP_TOKEN}
  require_transport_security: true
  notif_from: "Matrix <matrix@ninbura.com>"
  enable_notifs: true
  enable_password_resets: true
